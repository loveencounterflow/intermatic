{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\ntypes                     = new ( require 'intertype' ).Intertype()\n{ validate\n  isa\n  declare }               = types.export()\nfreeze                    = Object.freeze\nunless globalThis.debug?  then debug  = console.debug\nunless globalThis.rpr?    then rpr    = JSON.stringify\n\n#===========================================================================================================\n# TYPES\n#-----------------------------------------------------------------------------------------------------------\ndeclare 'trajectory', tests:\n  \"x isa list of texts\":      ( x ) -> @isa.list_of 'text', x\n  \"length is 0 or > 1\":       ( x ) -> ( x.length is 0 ) or ( x.length > 1 )\n\n#-----------------------------------------------------------------------------------------------------------\ndeclare 'verb', tests:\n  \"x isa nonempty_text\":      ( x ) -> @isa.nonempty_text x\n  # \"x is not a reserved word\": ( x ) ->\n  # \"x is not an lstate\": ( x ) ->\n  # or test against catalog of known verbs\n\n#-----------------------------------------------------------------------------------------------------------\ndeclare 'lstate', tests:\n  \"x isa nonempty_text\":      ( x ) -> @isa.nonempty_text x\n  # \"x is not a reserved word\": ( x ) ->\n  # \"x is not an verb\": ( x ) ->\n  # or test against catalog of known verbs\n\n#-----------------------------------------------------------------------------------------------------------\ndeclare 'actions', tests:\n  ### TAINT allow async functions ###\n  \"x isa list of functions\":      ( x ) -> @isa.list_of 'function', x\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nset = ( target, key, value ) ->\n  if target[ key ] isnt undefined\n    throw new Error \"^intermatic/set@776^ name collision: #{rpr key}\"\n  target[ key ] = value\n  return value\n\n#-----------------------------------------------------------------------------------------------------------\npush_circular = ( xs, x, max_length = 1 ) ->\n  R = [ xs..., x, ]\n  R.shift() while R.length > max_length\n  return freeze R\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nclass Intermatic\n\n  #---------------------------------------------------------------------------------------------------------\n  @_tid: 0\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( fsmd ) ->\n    # validate.fsmd fsmd\n    # @_types             = types\n    @_tmp               = {}\n    @_tmp.fsmd          = { fsmd..., }\n    @_tmp.known_names   = new Set()\n    # @_mnames            = new Set()\n    @moves              = null\n    @cascades           = null\n    @lstates            = null\n    @fsm_names          = []\n    @has_subfsms        = false\n    @_stage             = null\n    @_lstate            = 'void'\n    @_trigger_stages    = freeze [ 'before', 'after', ]\n    @_state_stages      = freeze [ 'entering', 'leaving', 'keeping', ]\n    do =>\n      for stages in [ @_trigger_stages, @_state_stages, ]\n        set @, stage, {} for stage in stages\n    @data               = null\n    @history_length     = 1\n    @_prv_lstates       = [ @_lstate, ]\n    @_prv_verbs         = []\n    @_nxt_dpar          = null\n    @_nxt_dest          = null\n    @_nxt_verb          = null\n    @up                 = null\n    @_path              = null\n    @_compile_fail()\n    # @_compile_cyclers()\n    @_compile_moves()\n    @_compile_triggers()\n    @_compile_actions()\n    # @_compile_handlers()\n    # @_compile_goto()\n    # @_compile_can()\n    # @_compile_tryto()\n    # @_compile_subfsms()\n    # @_compile_data()\n    # @_compile_cascades()\n    # @_copy_other_attributes()\n    delete @_tmp\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  Object.defineProperties @prototype,\n    #-------------------------------------------------------------------------------------------------------\n    lstate:\n      get:            -> @_lstate\n      set: ( lstate ) ->\n        if typeof lstate isnt 'string'\n          throw new Error \"^intermatic/set/lstate@501^ lstate name must be text, got #{rpr lstate}\"\n        @_prv_lstates = push_circular @_prv_lstates, lstate, @history_length + 1\n        @_lstate      = lstate\n    #-------------------------------------------------------------------------------------------------------\n    cstate:\n      get: ->\n        R                 = {}\n        R.path            = @path\n        R.lstate          = @lstate\n        R.verb            = x if ( x = @verb    )?\n        R.dpar            = x if ( x = @dpar    )?\n        R.dest            = x if ( x = @dest    )?\n        R.changed         = x if ( x = @changed )? and x\n        R.failed          = true if ( @dpar? and not @dest? )\n        R.data            = freeze { x..., } if ( x = @data )?\n        R[ subfsm_name ]  = @[ subfsm_name ].cstate for subfsm_name in @fsm_names\n        return freeze R\n    #-------------------------------------------------------------------------------------------------------\n    EXP_cstate:\n      get: ->\n        R                 = {}\n        R.lstate          = @lstate\n        R.data            = freeze { x..., } if ( x = @data )?\n        R[ subfsm_name ]  = @[ subfsm_name ].EXP_cstate for subfsm_name in @fsm_names\n        return freeze R\n    #-------------------------------------------------------------------------------------------------------\n    EXP_dstate:\n      get: ->\n        target        = { lstate: @lstate, }\n        R             = { [@name]: target, }\n        target.data   = @data if @data?\n        for subfsm_name in @fsm_names\n          sub_fsm = @[ subfsm_name ]\n          Object.assign target, sub_fsm.EXP_dstate\n        freeze target\n        return freeze R\n    #-------------------------------------------------------------------------------------------------------\n    stage:  get: -> @_stage\n    verb:   get: -> @_nxt_verb\n    dpar:   get: -> @_nxt_dpar\n    dest:   get: -> @_nxt_dest\n    #-------------------------------------------------------------------------------------------------------\n    move:   get: ->\n      R       = {}\n      R.stage = v if ( v = @stage )?\n      R.verb  = v if ( v = @verb  )?\n      R.dpar  = v if ( v = @dpar  )?\n      R.dest  = v if ( v = @dest  )?\n      return freeze R\n    #-------------------------------------------------------------------------------------------------------\n    fsms: get: -> ( @[ subfsm_name ] for subfsm_name in @fsm_names )\n    #-------------------------------------------------------------------------------------------------------\n    changed:\n      get: ->\n        return null unless @_nxt_dpar? and @_nxt_dest?\n        return @_nxt_dpar isnt @_nxt_dest\n    #-------------------------------------------------------------------------------------------------------\n    path:\n      get: ->\n        return R if ( R = @_path )?\n        return @_path = if @up? then \"#{@up.path}/#{@name}\" else @name\n    #-------------------------------------------------------------------------------------------------------\n    history:\n      get: ->\n        R = []\n        for verb, idx in @_prv_verbs\n          dpar  = @_prv_lstates[ idx ]\n          dest  = @_prv_lstates[ idx + 1 ]\n          R.push freeze { verb, dpar, dest, }\n        return freeze R\n\n  #---------------------------------------------------------------------------------------------------------\n  fail: ->\n    throw new Error \"^intermatic/fail@557^ trigger not allowed: #{rpr { name: @name, verb: @verb, dpar: @dpar, }}\"\n\n  #---------------------------------------------------------------------------------------------------------\n  _compile_fail: ->\n    @_tmp.known_names.add 'fail'\n    return null unless ( fail = @_tmp.fsmd.fail )?\n    @fail = fail.bind @\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _compile_moves: ->\n    @_tmp.known_names.add 'moves'\n    # starred       = {}\n    lstates       = new Set [ 'void', ]\n    fsmd_moves    = @_tmp.fsmd.moves = { ( @_tmp.fsmd.moves ? {} )..., }\n    @moves        = {}\n    verbs         = ( verb for verb of fsmd_moves )\n    #.......................................................................................................\n    unless fsmd_moves.start?\n      ### TAINT validate.nonempty_text fsmd_moves.start ###\n      ### TAINT validate.nonempty_list verbs ###\n      ### TAINT validate.nonempty_list fsmd_moves[ verbs[ 0 ] ][ 0 ] ###\n      first_lstate  = fsmd_moves[ verbs[ 0 ] ][ 0 ] ? 'void'\n      fsmd_moves.start   = [ 'void', first_lstate, ]\n    #.......................................................................................................\n    for verb, trajectory of fsmd_moves\n      ### If the verb is `start`, then value may be just the name of the start verb instead of a list ###\n      validate.verb verb\n      if ( verb is 'start' ) and ( not isa.list trajectory )\n        trajectory = [ 'void', trajectory, ]\n      validate.trajectory trajectory\n      continue unless trajectory.length > 0\n      #.....................................................................................................\n      for tidx in [ 0 ... trajectory.length - 1 ]\n        ### TAINT validate that free of collision ###\n        dpar  = trajectory[ tidx ]\n        dest  = trajectory[ tidx + 1 ]\n        #...................................................................................................\n        lstates.add dpar\n        lstates.add dest\n        set ( @moves[ verb ] ?= {} ), dpar, dest\n    #.......................................................................................................\n    @lstates = freeze [ lstates..., ]\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _compile_triggers: ->\n    for verb, dests_by_deps of @moves\n      do ( verb, dests_by_deps ) =>\n        trigger = @_get_trigger verb, dests_by_deps\n        set @, verb, trigger\n        @_tmp.known_names.add verb\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _compile_actions: ->\n    #.......................................................................................................\n    for stage in @_trigger_stages\n      @_tmp.known_names.add stage\n      continue unless ( source = @_tmp.fsmd[ stage ] )?\n      target = @[ stage ]\n      for verb, actions of source\n        ### TAINT validate.verb verb; esp validate not an lstate ###\n        validate.verb verb\n        actions = [ actions, ] unless isa.list actions\n        validate.actions actions\n        set target, verb, actions\n    #.......................................................................................................\n    for stage in @_state_stages\n      @_tmp.known_names.add stage\n      continue unless ( source = @_tmp.fsmd[ stage ] )?\n      target = @[ stage ]\n      for lstate, actions of source\n        ### TAINT validate.lstate lstate; esp validate not a verb ###\n        validate.lstate lstate\n        actions = [ actions, ] unless isa.list actions\n        validate.actions actions\n        set target, lstate, actions\n    #.......................................................................................................\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _call_actions: ( stage, verb_or_lstate, P ) ->\n    @_stage = stage\n    return null unless ( transitioners = @[ stage ]?[ verb_or_lstate ] )?\n    transitioner.apply @, P for transitioner in transitioners\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _get_trigger: ( verb, dests_by_deps = null ) ->\n    ### TAINT add extra arguments P ###\n    ### TAINT too much logic to be done at in run time, try to precompile more ###\n    return transitioner = ( P... ) =>\n      ### TAINT use single transitioner method for all triggers? ###\n      @_nxt_verb      = verb\n      ### TAINT consider to do this inside a property setter, as for `@lstate`: ###\n      @_prv_verbs     = push_circular @_prv_verbs, verb, @history_length\n      @_nxt_dpar      = dpar = @lstate\n      # id              = @_new_tid()\n      #-------------------------------------------------------------------------------------------------\n      # if not dests_by_deps?\n      #   debug '^374873^', verb, P\n      if dests_by_deps? then    dest          = ( dests_by_deps[ dpar ] ? null )\n      else                    [ dest, P..., ] = P\n      return @fail P... unless dest?\n      @_nxt_dest = dest\n      #.....................................................................................................\n      changed                   = dest isnt dpar\n      #.....................................................................................................\n      if @cascades and @cascades.has verb\n        for subfsm_name in @fsm_names\n          @[ subfsm_name ].tryto verb, P...\n      #.....................................................................................................\n      # for aname, actions of @before\n      #   continue unless ( aname is 'any' ) or ( aname is XXXX )\n      #   for action in actions\n      #     XXXXX\n      debug '^333344^', \"{ verb, dpar, dest, changed, } \", { verb, dpar, dest, changed, }\n      debug '^333344^', \"@[ verb ]                      \", @[ verb ]\n      debug '^333344^', \"@before.any                    \", @before.any\n      debug '^333344^', \"@before.#{verb}                \", @before[   verb ]\n      debug '^333344^', \"@leaving.#{dpar}               \", @leaving[  dpar ]\n      debug '^333344^', \"@entering.#{dest}              \", @entering[ dest ]\n      debug '^333344^', \"@after.#{verb}                 \", @after[    verb ]\n      # @before.any?              P...\n      # @before.change?           P... if changed\n      #.....................................................................................................\n      @_call_actions 'before',    'any',      P\n      @_call_actions 'before',    'change',   P if      changed\n      @_call_actions 'before',    verb,       P\n      @_call_actions 'leaving',   dpar,       P if      changed\n      @lstate                   = dest          if      changed\n      @_call_actions 'keeping',   dpar,       P if  not changed\n      @_call_actions 'entering',  dest,       P if      changed\n      @_call_actions 'after',     verb,       P\n      @_call_actions 'after',     'change',   P if      changed\n      @_call_actions 'after',     'any',      P\n      #.....................................................................................................\n      ### NOTE At this point, the transition has finished, so we reset the `@_nxt_*` attributes: ###\n      @_stage     = null\n      @_nxt_verb  = null\n      @_nxt_dest  = null\n      @_nxt_dpar  = null\n      #.....................................................................................................\n      return null\n\n  # #---------------------------------------------------------------------------------------------------------\n  # _compile_handlers: ->\n  #   ### TAINT add handlers for trigger, change ###\n  #   ### TAINT check names against reserved ###\n  #   try\n  #     for category in [ 'before', 'entering', 'keeping', 'leaving', 'after', ]\n  #       @_tmp.known_names.add category\n  #       for name, handler of @_tmp.fsmd[ category ] ? {}\n  #         @[ category ][ name ] = handler.bind @\n  #   catch error\n  #     error.message += \" â€” Error occurred during @_compile_handlers with #{rpr { category, name, handler, }}\"\n  #     throw error\n  #   return null\n\n  # #---------------------------------------------------------------------------------------------------------\n  # _compile_goto: ->\n  #   @_tmp.known_names.add 'goto'\n  #   if ( goto = @_tmp.fsmd.goto )?\n  #     unless goto is '*'\n  #       throw new Error \"^intermatic/_compile_handlers@776^ expected '*' for key `goto`, got #{rpr goto}\"\n  #     transitioner  = @_get_trigger 'goto', null\n  #     goto          = ( dest, P... ) => transitioner dest, P...\n  #     for dest in @lstates\n  #       do ( dest ) =>\n  #         goto[ dest ] = ( P... ) => transitioner dest, P...\n  #     set @, 'goto', goto\n  #   return null\n\n  # #---------------------------------------------------------------------------------------------------------\n  # _compile_can: ->\n  #   @_tmp.known_names.add 'can'\n  #   can = ( verb ) =>\n  #     unless ( trigger = @triggers[ verb ] )?\n  #       throw new Error \"^intermatic/can@822^ unknown trigger #{rpr verb}\"\n  #     return trigger[ @lstate ]?\n  #   for verb of @triggers\n  #     do ( verb ) =>\n  #       can[ verb ] = ( P... ) => can verb, P...\n  #   set @, 'can', can\n  #   return null\n\n  # #---------------------------------------------------------------------------------------------------------\n  # _compile_tryto: ->\n  #   @_tmp.known_names.add 'tryto'\n  #   tryto = ( verb, P... ) =>\n  #     return false unless @can verb\n  #     ### TAINT we will possibly want to return some kind of result from trigger ###\n  #     @[ verb ] P...\n  #     return true\n  #   for verb of @triggers\n  #     do ( verb ) =>\n  #       tryto[ verb ] = ( P... ) => tryto verb, P...\n  #   set @, 'tryto', tryto\n  #   return null\n\n  # #---------------------------------------------------------------------------------------------------------\n  # _compile_subfsms: ->\n  #   @_tmp.known_names.add 'fsms'\n  #   fsm_names = []\n  #   for sub_fname, sub_fsmd of @_tmp.fsmd.fsms ? {}\n  #     sub_fsmd  = { sub_fsmd..., }\n  #     if sub_fsmd.name? and sub_fsmd.name isnt sub_fname\n  #       throw new Error \"^intermatic/_compile_subfsms@506^ name mismatch, got #{rpr sub_fname}, #{rpr sub_fsmd.name}\"\n  #     sub_fsmd.name = sub_fname\n  #     set sub_fsmd, 'up', @\n  #     @_tmp.known_names.add sub_fname\n  #     fsm_names.push   sub_fname\n  #     set @, sub_fname, new @constructor sub_fsmd\n  #   @fsm_names    = freeze fsm_names\n  #   @has_subfsms  = fsm_names.length > 0\n  #   return null\n\n  # #---------------------------------------------------------------------------------------------------------\n  # _compile_data: ->\n  #   @_tmp.known_names.add 'data'\n  #   return null unless ( data = @_tmp.fsmd.data )?\n  #   @data = {}\n  #   for pname, propd of Object.getOwnPropertyDescriptors @_tmp.fsmd.data\n  #     Object.defineProperty @data, pname, propd\n  #   return null\n\n  # #---------------------------------------------------------------------------------------------------------\n  # _compile_cascades: ->\n  #   @_tmp.known_names.add 'cascades'\n  #   return null unless ( cascades = @_tmp.fsmd.cascades )?\n  #   @cascades = new Set cascades\n  #   return null\n\n  # #---------------------------------------------------------------------------------------------------------\n  # _copy_other_attributes: ->\n  #   for pname, propd of Object.getOwnPropertyDescriptors @_tmp.fsmd\n  #     continue if @_tmp.known_names.has pname\n  #     Object.defineProperty @, pname, propd\n  #   return null\n\n\n############################################################################################################\nmodule.exports = Intermatic\n# if globalThis.require? then module.exports        = { Intermatic, }\n# else                        globalThis.Intermatic = Intermatic\n\n\n\n"
  ]
}